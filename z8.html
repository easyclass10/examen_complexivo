<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interactivo de Auditoría Financiera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .tab.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-left-color: #a5b4fc; /* indigo-300 */
        }
        .tab {
            transition: all 0.2s ease-in-out;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .quiz-choice-btn {
            transition: all 0.2s ease-in-out;
        }
        .quiz-choice-btn.correct {
            background-color: #16a34a !important; /* green-600 */
            color: white;
            border-color: #16a34a !important;
        }
        .quiz-choice-btn.incorrect {
            background-color: #dc2626 !important; /* red-600 */
            color: white;
            border-color: #dc2626 !important;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 1rem auto;
            height: 250px;
        }
        input[type="range"]::-webkit-slider-thumb { background: #4f46e5; }
        input[type="range"]::-moz-range-thumb { background: #4f46e5; }
    </style>
</head>
<body class="text-slate-800">

    <div class="bg-slate-800 text-white p-2 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <img src="logo.png" alt="Logotipo de Easyclass" class="h-8">
                <span class="font-bold text-lg">easyclass</span>
            </div>
            <div class="flex items-center gap-3">
                <span id="user-email-display" class="font-semibold"></span>
                <button id="logout-button" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded-md transition font-semibold">Cerrar Sesión</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Guia de Auditoría Financiera</h1>
            <p class="text-lg text-slate-600 mt-2">Basado en NIAs y Normativa Ecuatoriana.</p>
        </header>

        <div class="flex flex-col md:flex-row gap-8">
            <aside class="w-full md:w-1/4 bg-white p-6 rounded-lg shadow-md h-fit">
                <a href="index.html" class="inline-block w-full bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-slate-300 transition text-center mb-6">
                    ← Volver al Menú
                </a>
                <h2 class="text-lg font-bold mb-4 border-b pb-2">Temario</h2>
                <nav id="topic-nav" class="flex flex-col gap-2">
                    <!-- Los botones de navegación se agregarán aquí con JavaScript -->
                </nav>
            </aside>
            <main id="topic-content" class="w-full md:w-3/4 bg-white p-6 rounded-xl shadow-md">
                </main>
        </div>
    </div>
<script src="todos.js"></script>
<script>
    const studyGuideData = {
        topics: [
            {
                id: 'objetivo',
                title: 'Objetivo de la Auditoría',
                explanation: `
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Objetivos Globales del Auditor (NIA 200)</h2>
                    <p class="mb-4">El propósito de una auditoría es aumentar la confianza de los usuarios en los estados financieros. Esto se logra mediante la expresión de una opinión sobre si han sido preparados, en todos sus aspectos materiales, de conformidad con un marco de información financiera aplicable.</p>
                    <h4 class="font-semibold text-lg mt-4 mb-2">Conceptos Fundamentales</h4>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>Seguridad Razonable:</strong> Concluir que los EEFF están libres de incorrección material (no es seguridad absoluta).</li>
                        <li><strong>Escepticismo Profesional:</strong> Una actitud inquisitiva y una evaluación crítica de la evidencia.</li>
                        <li><strong>Juicio Profesional:</strong> Aplicación de formación y experiencia para tomar decisiones informadas.</li>
                    </ul>
                `,
                examples: [
                    { title: 'Escepticismo Profesional en Ecuador', description: 'Un cliente presenta un contrato de servicios con una empresa en un paraíso fiscal. El escepticismo lleva al auditor a solicitar evidencia adicional del servicio efectivamente prestado para descartar que sea un gasto ficticio.' },
                    { title: 'Juicio Profesional en la Materialidad', description: 'El auditor decide que la "utilidad antes de impuestos" es el benchmark más relevante para la materialidad, ya que en Ecuador impacta directamente en el cálculo del 15% de participación de trabajadores y el impuesto a la renta.' }
                ],
                quiz: [
                    { question: "El objetivo principal de una auditoría de estados financieros según la NIA 200 es:", choices: { a: "Detectar todos los fraudes y errores.", b: "Aumentar el grado de confianza de los usuarios en los estados financieros mediante una opinión.", c: "Garantizar la viabilidad futura de la entidad."}, answer: 'b', explanation: "El objetivo es aumentar la confianza de los usuarios mediante una opinión profesional." }
                ]
            },
            {
                id: 'riesgos',
                title: 'Riesgos de Auditoría',
                explanation: `
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Modelo de Riesgo de Auditoría</h2>
                    <p class="mb-4">El Riesgo de Auditoría (RA) es el riesgo de que el auditor exprese una opinión inapropiada. Se descompone en: <code class="bg-slate-100 p-1 rounded">RA = RIM × RD</code>, donde RIM es el Riesgo de Incorrección Material (Inherente x Control) y RD es el Riesgo de Detección.</p>
                    <div class="bg-slate-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-lg mb-2 text-center">Simulador Interactivo del Modelo de Riesgo</h4>
                        <div class="grid md:grid-cols-2 gap-6 items-center">
                            <div class="space-y-4">
                                <div>
                                    <label for="ri-slider" class="block text-sm font-medium">Riesgo Inherente (RI): <span id="ri-val" class="font-bold text-indigo-600">80%</span></label>
                                    <input id="ri-slider" type="range" min="10" max="100" value="80" class="w-full">
                                </div>
                                <div>
                                    <label for="rc-slider" class="block text-sm font-medium">Riesgo de Control (RC): <span id="rc-val" class="font-bold text-indigo-600">50%</span></label>
                                    <input id="rc-slider" type="range" min="10" max="100" value="50" class="w-full">
                                </div>
                            </div>
                            <div class="chart-container h-48 md:h-64"><canvas id="riskChart"></canvas></div>
                        </div>
                    </div>
                `,
                examples: [],
                quiz: [
                    { question: "Si el auditor valora el Riesgo de Incorrección Material (RIM) como alto, para mantener un Riesgo de Auditoría bajo, debe planificar sus procedimientos para que el Riesgo de Detección (RD) sea:", choices: { a: "Alto", b: "Bajo", c: "Irrelevante"}, answer: 'b', explanation: "Existe una relación inversa entre RIM y RD para mantener constante el RA. Si el riesgo de que haya un error es alto, el riesgo de no detectarlo debe ser bajo, lo que implica más trabajo." }
                ]
            },
             {
                id: 'opinion',
                title: 'Tipos de Opinión',
                explanation: `
                     <h2 class="text-2xl font-bold mb-4 text-slate-900">Tipos de Opinión e Informes</h2>
                     <p class="mb-4">El producto final de la auditoría es el informe. La elección de la opinión depende de si existe una incorrección material o una limitación al alcance, y si su efecto es generalizado.</p>
                     <ul class="list-disc list-inside space-y-2">
                        <li><strong>Opinión No Modificada (Limpia):</strong> Los EEFF están libres de incorrección material.</li>
                        <li><strong>Opinión con Salvedades:</strong> Existe una incorrección o limitación que es material, pero no generalizada.</li>
                        <li><strong>Opinión Desfavorable (Adversa):</strong> Existe una incorrección que es material y generalizada.</li>
                        <li><strong>Denegación de Opinión (Abstención):</strong> Existe una limitación al alcance que es material y generalizada.</li>
                     </ul>
                `,
                examples: [],
                quiz: [
                    { question: "Una incorrección material pero no generalizada en los estados financieros dará lugar a una:", choices: { a: "Opinión con salvedades.", b: "Opinión desfavorable.", c: "Denegación de opinión."}, answer: 'a', explanation: "Una incorrección material pero no generalizada es la definición exacta para una opinión con salvedades." },
                    { question: "La principal diferencia entre una opinión desfavorable y una denegación de opinión es:", choices: { a: "La desfavorable es por limitación al alcance, y la denegación por incorrección.", b: "La desfavorable es por incorrección material, y la denegación por limitación al alcance.", c: "No hay diferencia."}, answer: 'b', explanation: "La opinión desfavorable se basa en la existencia de evidencia de incorrección, mientras que la denegación se basa en la falta de evidencia." }
                ]
            }
        ]
    };

    document.addEventListener('DOMContentLoaded', () => {
        const navContainer = document.getElementById('topic-nav');
        const contentContainer = document.getElementById('topic-content');
        let currentTopicId = studyGuideData.topics[0].id;
        let riskChart;
        
        const renderNav = () => {
             navContainer.innerHTML = studyGuideData.topics.map(topic => `
                <button data-topic-id="${topic.id}" class="tab text-left w-full p-3 rounded-lg border-l-4 border-transparent ${topic.id === currentTopicId ? 'active' : 'bg-slate-200 hover:bg-slate-300'}">
                    ${topic.title}
                </button>
            `).join('');
        };
        
        const renderContent = () => {
            const topic = studyGuideData.topics.find(t => t.id === currentTopicId);
            if (!topic) return;
            
            const examplesHtml = topic.examples.map(ex => `
                <div class="mb-6 p-4 bg-slate-50 rounded-lg">
                    <h4 class="font-semibold text-slate-800">${ex.title}</h4>
                    <p class="text-sm text-slate-600">${ex.description}</p>
                </div>
            `).join('');

            const quizHtml = topic.quiz.length > 0 ? `
                <div class="mt-8 pt-6 border-t border-slate-200">
                    <h3 class="text-xl font-bold text-slate-900 mb-4">Autoevaluación</h3>
                    <div id="quiz-container" class="p-4 border border-slate-200 rounded-lg"></div>
                </div>
            ` : '';

            contentContainer.innerHTML = `
                <div id="${topic.id}" class="content-section active">
                    ${topic.explanation}
                    ${topic.examples.length > 0 ? `<div class="mt-8"><h3 class="text-xl font-bold text-slate-900 mb-4">Ejemplos Prácticos</h3>${examplesHtml}</div>` : ''}
                    ${quizHtml}
                </div>
            `;
            
            if (topic.id === 'riesgos') initRiskChart();
            if (topic.quiz.length > 0) renderQuiz(topic.id, 0);
        };
        
        function initRiskChart() {
            const ctx = document.getElementById('riskChart')?.getContext('2d');
            if (!ctx) return;
            const riSlider = document.getElementById('ri-slider');
            const rcSlider = document.getElementById('rc-slider');
            const riVal = document.getElementById('ri-val');
            const rcVal = document.getElementById('rc-val');
            const acceptableRA = 0.05;

            function calculateAndDraw() {
                const ri = riSlider.value / 100;
                const rc = rcSlider.value / 100;
                const rim = ri * rc;
                const rd = rim > 0 ? Math.min(1, acceptableRA / rim) : 1;
                riVal.textContent = `${riSlider.value}%`;
                rcVal.textContent = `${rcSlider.value}%`;
                riskChart.data.datasets[0].data = [rim * 100, rd * 100];
                riskChart.update();
            }

            if(riskChart) riskChart.destroy();
            riskChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Riesgo Incorrección Material (RIM)', 'Riesgo Detección (RD) Requerido'],
                    datasets: [{ data: [], backgroundColor: ['#ef4444', '#3b82f6'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, max: 100, ticks: { callback: value => value + '%' } } }, plugins: { legend: { display: false } } }
            });

            riSlider.addEventListener('input', calculateAndDraw);
            rcSlider.addEventListener('input', calculateAndDraw);
            calculateAndDraw();
        }
        
        const renderQuiz = (topicId, questionIndex) => {
            const topic = studyGuideData.topics.find(t => t.id === topicId);
            if (!topic || questionIndex >= topic.quiz.length) {
                 document.getElementById('quiz-container').innerHTML = `<p class="text-center font-semibold text-green-600">¡Has completado todas las preguntas!</p>`;
                return;
            }
            const quizContainer = document.getElementById('quiz-container');
            const questionData = topic.quiz[questionIndex];
            const choicesHtml = Object.entries(questionData.choices).map(([key, value]) => `
                <button data-choice="${key}" class="quiz-choice-btn w-full text-left p-3 border border-slate-300 rounded-lg hover:bg-slate-100">
                    <span class="font-bold mr-2">${key.toUpperCase()})</span> ${value}
                </button>
            `).join('');
            quizContainer.innerHTML = `
                <p class="font-semibold mb-4">${questionIndex + 1}. ${questionData.question}</p>
                <div class="space-y-3">${choicesHtml}</div>
                <div id="quiz-feedback" class="mt-4 p-4 rounded-lg bg-slate-100 hidden"></div>
                <div class="text-right mt-4">
                    <button id="next-q-btn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-indigo-700 disabled:bg-slate-400" disabled>Siguiente</button>
                </div>
            `;
            attachQuizListeners(topicId, questionIndex);
        };

        const attachQuizListeners = (topicId, questionIndex) => {
            const questionData = studyGuideData.topics.find(t => t.id === topicId).quiz[questionIndex];
            const feedbackEl = document.getElementById('quiz-feedback');
            const nextBtn = document.getElementById('next-q-btn');
            document.querySelectorAll('.quiz-choice-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const selectedChoice = e.currentTarget.dataset.choice;
                    document.querySelectorAll('.quiz-choice-btn').forEach(b => b.disabled = true);
                    if (selectedChoice === questionData.answer) {
                        e.currentTarget.classList.add('correct');
                        feedbackEl.innerHTML = `<p class="font-semibold text-green-700">¡Correcto!</p><p class="mt-2 text-sm">${questionData.explanation}</p>`;
                    } else {
                        e.currentTarget.classList.add('incorrect');
                        document.querySelector(`.quiz-choice-btn[data-choice="${questionData.answer}"]`).classList.add('correct');
                        feedbackEl.innerHTML = `<p class="font-semibold text-red-700">Incorrecto.</p><p class="mt-2 text-sm">${questionData.explanation}</p>`;
                    }
                    feedbackEl.classList.remove('hidden');
                    nextBtn.disabled = false;
                });
            });
            nextBtn.addEventListener('click', () => renderQuiz(topicId, questionIndex + 1));
        };

        navContainer.addEventListener('click', (e) => {
            if (e.target.closest('.tab')) {
                const topicId = e.target.closest('.tab').dataset.topicId;
                if (topicId !== currentTopicId) {
                    currentTopicId = topicId;
                    renderNav();
                    renderContent();
                }
            }
        });
        renderNav();
        renderContent();
    });
</script>

</body>
</html>
